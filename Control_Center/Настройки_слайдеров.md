# Настройки слайдеров в центре управления: цвета, закругления, обводка

❗[Необходима Предварительная Подготовка](https://github.com/mizter-kot/Miui_14_Mods/blob/main/Control_Center/Предварительная_подготовка.md)❗

## MiuiSystemUIPlugin.apk

### Класс Lmiui/systemui/controlcenter/brightness/ToggleSliderController;

В методе

```smali
.method public updateResources()V
```

добавить один локальный регистр

```smali
.locals 2 -> .locals 3
```

затем после `.locals` добавить

```smali
move-object v2, p0
```

Найти в этом же методе строки (❗обратить внимание на регистры v0 и p0❗)

```smali
sget v1, Lmiui/systemui/controlcenter/R$id;->slider:I

invoke-virtual {v0, v1}, Landroid/widget/SeekBar;->findViewById(I)Landroid/view/View;

move-result-object v0

check-cast v0, Lmiui/systemui/controlcenter/widget/VerticalToggleSeekBar;

invoke-virtual {p0}, Lmiui/systemui/controlcenter/brightness/ToggleSliderController;->getContext()Landroid/content/Context;

move-result-object p0
```

и после них добавить

```smali
invoke-static {p0}, LMyControlCenterUtils;->getMyNewCcSettingsEnabled(Landroid/content/Context;)Z

move-result v1

if-eqz v1, :set_default_drawable

invoke-direct {v2, v0}, Lmiui/systemui/controlcenter/brightness/ToggleSliderController;->setMyCustomSlider(Lmiui/systemui/controlcenter/widget/VerticalToggleSeekBar;)V

return-void

:set_default_drawable
```

В конец класса добавить

```smali
.method private setMyCustomSlider(Lmiui/systemui/controlcenter/widget/VerticalToggleSeekBar;)V
    .locals 5
    
    invoke-virtual {p1}, Lmiui/systemui/controlcenter/widget/VerticalToggleSeekBar;->getProgressDrawable()Landroid/graphics/drawable/Drawable;
    
    move-result-object v4
    
    if-eqz v4, :return
    
    instance-of v0, v4, Landroid/graphics/drawable/LayerDrawable;
    
    if-eqz v0, :return
    
    check-cast v4, Landroid/graphics/drawable/LayerDrawable; # progress layer drawable
    
    invoke-virtual {p0}, Lmiui/systemui/controlcenter/brightness/ToggleSliderController;->getContext()Landroid/content/Context;
    
    move-result-object v0
    
    invoke-static {v0}, LMyControlCenterUtils;->getCustomDrawableForSliderBackground(Landroid/content/Context;)Landroid/graphics/drawable/Drawable;
    
    move-result-object v1 # bg slider
    
    invoke-static {v0}, LMyControlCenterUtils;->getCustomDrawableForSliderForeground(Landroid/content/Context;)Landroid/graphics/drawable/Drawable;
    
    move-result-object v2 # fg slider
    
    const/4 v0, 0x0
    
    invoke-virtual {v4, v0, v1}, Landroid/graphics/drawable/LayerDrawable;->setDrawable(ILandroid/graphics/drawable/Drawable;)V
    
    const/4 v0, 0x2
    
    invoke-virtual {v4, v0}, Landroid/graphics/drawable/LayerDrawable;->getDrawable(I)Landroid/graphics/drawable/Drawable;
    
    move-result-object v0
    
    instance-of v3, v0, Landroid/graphics/drawable/ClipDrawable;
    
    if-eqz v3, :return
    
    check-cast v0, Landroid/graphics/drawable/ClipDrawable;
    
    invoke-virtual {v0, v2}, Landroid/graphics/drawable/ClipDrawable;->setDrawable(Landroid/graphics/drawable/Drawable;)V
    
    invoke-virtual {p1, v4}, Lmiui/systemui/controlcenter/widget/VerticalToggleSeekBar;->setProgressDrawable(Landroid/graphics/drawable/Drawable;)V
    
    invoke-direct {p0}, Lmiui/systemui/controlcenter/brightness/ToggleSliderController;->setMyCustomSlidersIconsColor()V
    
    :return
    return-void
.end method

.method private setMyCustomSlidersIconsColor()V
    .locals 3
    
    invoke-virtual {p0}, Lmiui/systemui/controlcenter/brightness/ToggleSliderController;->getContext()Landroid/content/Context;
    
    move-result-object v0
    
    invoke-static {v0}, LMyControlCenterUtils;->getCustomSliderIconColor(Landroid/content/Context;)I
    
    move-result v0

    # SRC_IN removes default image pixels completely. You will only see pixels of your color whatever alpha you set.
    # With SRC_ATOP, if you set color alpha less than 0xff, custom color pixels will blend with default pixels.
    sget-object v1, Landroid/graphics/PorterDuff$Mode;->SRC_IN:Landroid/graphics/PorterDuff$Mode; 
    
    invoke-virtual {p0}, Lmiui/systemui/controlcenter/brightness/ToggleSliderController;->getIconA()Landroid/widget/ImageView;
    
    move-result-object v2
    
    invoke-virtual {v2, v0, v1}, Landroid/widget/ImageView;->setColorFilter(ILandroid/graphics/PorterDuff$Mode;)V
    
    invoke-virtual {p0}, Lmiui/systemui/controlcenter/brightness/ToggleSliderController;->getIconB()Landroid/widget/ImageView;
    
    move-result-object v2
    
    invoke-virtual {v2, v0, v1}, Landroid/widget/ImageView;->setColorFilter(ILandroid/graphics/PorterDuff$Mode;)V
    
    return-void
.end method
```

### res/values/colors.xml

Если этого не сделать, непрозрачность кастомного цвета иконок слайдеров не поднимется выше 0x4d. Если сделать, то при выключенных настройках иконки будут полностью чёрными. 

Найти цвет

```xml
<color name="toggle_slider_icon_color">#4d000000</color>
```

и изменить прозрачность на ff:

```xml
<color name="toggle_slider_icon_color">#ff000000</color>
```

## Settings.apk

### res/xml/*.xml

Добавить

```xml
<PreferenceCategory android:title="Настройки слайдеров">
    <XMiuiColorPickerPreference 
        android:title="Цвет переднего фона" 
        android:key="my_slider_fg_color"  
        android:defaultValue="#ffffffff"
        android:dependency="my_new_cc_settings_enabled"
        alphaSlider="true" 
        hexValue="true" />
    <XMiuiColorPickerPreference 
        android:title="Цвет заднего фона" 
        android:key="my_slider_bg_color"  
        android:defaultValue="#26ffffff"
        android:dependency="my_new_cc_settings_enabled"
        alphaSlider="true" 
        hexValue="true" />      
    <XMiuiCheckBoxPreference
        android:title="Градиент слайдеров"
        android:key="my_slider_gradient_enabled"
        android:defaultValue="false"
        android:summaryOn="Включен"
        android:summaryOff="Выключен"
        android:dependency="my_new_cc_settings_enabled" />
    <XMiuiColorPickerPreference 
        android:title="Первый цвет градиента переднего фона" 
        android:key="my_slider_fg_gradient_first_color"  
        android:defaultValue="#ffffffff"
        android:dependency="my_slider_gradient_enabled"
        alphaSlider="true" 
        hexValue="true" />
    <XMiuiColorPickerPreference 
        android:title="Второй цвет градиента переднего фона" 
        android:key="my_slider_fg_gradient_second_color"  
        android:defaultValue="#ffffffff"
        android:dependency="my_slider_gradient_enabled"
        alphaSlider="true" 
        hexValue="true" />            
    <XMiuiColorPickerPreference 
        android:title="Первый цвет градиента заднего фона" 
        android:key="my_slider_bg_gradient_first_color"  
        android:defaultValue="#26ffffff"
        android:dependency="my_slider_gradient_enabled"
        alphaSlider="true" 
        hexValue="true" />
    <XMiuiColorPickerPreference 
        android:title="Второй цвет градиента заднего фона" 
        android:key="my_slider_bg_gradient_second_color"  
        android:defaultValue="#26ffffff"
        android:dependency="my_slider_gradient_enabled"
        alphaSlider="true" 
        hexValue="true" />
    <XMiuiListPreference 
        android:entries="@array/gradient_orientation_entries"
        android:entryValues="@array/gradient_orientation_values"
        android:title="Ориентация градиента переднего фона"
        android:key="my_slider_fg_gradient_orientation"
        android:summary="%s"
        android:defaultValue="LEFT_RIGHT" 
        android:dependency="my_slider_gradient_enabled" />
    <XMiuiListPreference 
        android:entries="@array/gradient_orientation_entries"
        android:entryValues="@array/gradient_orientation_values"
        android:title="Ориентация градиента заднего фона"
        android:key="my_slider_bg_gradient_orientation"
        android:summary="%s"
        android:defaultValue="LEFT_RIGHT" 
        android:dependency="my_slider_gradient_enabled" />
    <XMiuiSeekBarPreference 
        android:layout="@layout/miuix_seekbar" 
        android:title="Ширина обводки слайдеров" 
        android:key="my_slider_stroke_width" 
        android:defaultValue="0"
        android:dependency="my_new_cc_settings_enabled"
        enableSummary="true" 
        min="0" max="20" />
    <XMiuiColorPickerPreference 
        android:title="Цвет обводки слайдеров" 
        android:key="my_slider_stroke_color"  
        android:defaultValue="#00000000"
        android:dependency="my_new_cc_settings_enabled"
        alphaSlider="true" 
        hexValue="true" />
    <XMiuiSeekBarPreference 
        android:layout="@layout/miuix_seekbar" 
        android:title="Радиус закругления углов слайдеров" 
        android:key="my_slider_corner_radius" 
        android:defaultValue="40"
        android:dependency="my_new_cc_settings_enabled"
        enableSummary="true" 
        min="0" max="100" />
    <XMiuiColorPickerPreference 
        android:title="Цвет иконок яркости и громкости" 
        android:key="my_slider_icon_color"  
        android:defaultValue="#4d000000"
        android:dependency="my_new_cc_settings_enabled"
        alphaSlider="true" 
        hexValue="true" />
</PreferenceCategory>
```
