# MiuiSystemUIPlugin.apk

## Lmiui/systemui/controlcenter/qs/QSPager;

###### Здесь настройка количества рядов тоглов на первой странице и обновлялка разметки тайлов и тоглов.

### .method public constructor \<init\>(Landroid/content/Context;Landroid/util/AttributeSet;)V

Найти `return-void`, выше добавить:

```smali
invoke-direct {p0}, Lmiui/systemui/controlcenter/qs/QSPager;->getMyRowsCount()I

move-result v0

iput v0, p0, Lmiui/systemui/controlcenter/qs/QSPager;->myRowsCount:I

sput-object p0, Lmiui/systemui/controlcenter/qs/QSPager;->INSTANCE:Lmiui/systemui/controlcenter/qs/QSPager;
```

### .method private final distributeTiles()V

Найти `const/4 v8, 0x4`, заменить на:

```smali
iget v8, p0, Lmiui/systemui/controlcenter/qs/QSPager;->myRowsCount:I
```

### Добавить в конец класса

```smali
.field private myRowsCount:I

.field public static INSTANCE:Lmiui/systemui/controlcenter/qs/QSPager;

.method private getMyRowsCount()I
    .locals 4
    
    invoke-virtual {p0}, Lmiui/systemui/controlcenter/qs/QSPager;->getContext()Landroid/content/Context;
    
    move-result-object v0
    
    invoke-virtual {v0}, Landroid/content/Context;->getContentResolver()Landroid/content/ContentResolver;
    
    move-result-object v0
    
    const-string v1, "my_first_page_rows_count"
    
    const/4 v2, 0x2
    
    invoke-static {v0, v1, v2}, Landroid/provider/Settings$System;->getInt(Landroid/content/ContentResolver;Ljava/lang/String;I)I
    
    move-result v2
    
    const-string v1, "my_tiles_count"
    
    const/4 v3, 0x2
    
    invoke-static {v0, v1, v3}, Landroid/provider/Settings$System;->getInt(Landroid/content/ContentResolver;Ljava/lang/String;I)I
    
    move-result v3
    
    const/4 v1, 0x2
    
    if-ne v1, v3, :four_or_six
    
    add-int/lit8 v2, v2, 0x2 # Add 2 rows for 2 big tiles
    
    goto :return
    
    :four_or_six
    const/4 v1, 0x4
    
    if-ne v1, v3, :six
    
    add-int/lit8 v2, v2, 0x3 # Add 3 rows for 4 big tiles
    
    goto :return
    
    :six
    add-int/lit8 v2, v2, 0x4 # Add 4 rows for 6 big tiles
    
    :return
    return v2
.end method

.method public updateTilesLayout(Lmiui/systemui/controlcenter/qs/tileview/BigTileGroupController;)V
    .locals 5
    
    iput-object p1, p0, Lmiui/systemui/controlcenter/qs/QSPager;->header:Lmiui/systemui/controlcenter/qs/tileview/BigTileGroupController;
    
    invoke-direct {p0}, Lmiui/systemui/controlcenter/qs/QSPager;->getMyRowsCount()I

    move-result v0

    iput v0, p0, Lmiui/systemui/controlcenter/qs/QSPager;->myRowsCount:I
    
    const/4 v0, 0x1
    
    iput-boolean v0, p0, Lmiui/systemui/controlcenter/qs/QSPager;->distributeTiles:Z
    
    invoke-direct {p0}, Lmiui/systemui/controlcenter/qs/QSPager;->distributeTiles()V
    
    const/4 v0, 0x0
    
    iput-boolean v0, p0, Lmiui/systemui/controlcenter/qs/QSPager;->distributeTiles:Z
    
    return-void
.end method
```

---

## Lmiui/systemui/controlcenter/qs/tileview/BigTileGroupController;

###### Здесь новые тайлы, выбор значения тайлов, разметка тайлов и слайдеров, вызов вышеупомянутой обновлялки.

### .method private final updateResources()V

`.locals 10` -> `.locals 11`

После `.locals` добавить:

```smali
move-object v10, p0
```

Найти:

```smali
sget v4, Lmiui/systemui/controlcenter/R$dimen;->volume_brightness_slider_weight:I

invoke-virtual {v3, v4}, Landroid/content/res/Resources;->getFloat(I)F

move-result v3

mul-float/2addr v3, v2

float-to-int v2, v3

mul-int/lit8 v3, v1, 0x2

sub-int v6, v0, v3
```

После этого добавить:

```smali
iput v6, p0, Lmiui/systemui/controlcenter/qs/tileview/BigTileGroupController;->bigTileCalculatedMarginTop:I
```

Найти:

```smali
sget v3, Lmiui/systemui/controlcenter/R$id;->big_tile_a:I

invoke-virtual {v0, v3}, Landroidx/constraintlayout/widget/ConstraintLayout;->findViewById(I)Landroid/view/View;

move-result-object v0

invoke-virtual {v0}, Landroid/view/View;->getLayoutParams()Landroid/view/ViewGroup$LayoutParams;

move-result-object v0

iput v1, v0, Landroid/view/ViewGroup$LayoutParams;->width:I
```

После этого добавить:

```smali
iput v1, p0, Lmiui/systemui/controlcenter/qs/tileview/BigTileGroupController;->bigTileCalculatedWidth:I
```

Найти `return-void`, до него добавить:

```smali
invoke-direct {v10}, Lmiui/systemui/controlcenter/qs/tileview/BigTileGroupController;->customUpdateResources()V
```

### .method protected getChildControllers()Ljava/util/ArrayList;

После `.locals` добавить:

```smali
invoke-direct {p0}, Lmiui/systemui/controlcenter/qs/tileview/BigTileGroupController;->customGetChildControllers()Ljava/util/ArrayList;

move-result-object p0

return-object p0
```

### .method public final getRow()I

После `.locals` добавить:

```smali
invoke-direct {p0}, Lmiui/systemui/controlcenter/qs/tileview/BigTileGroupController;->customGetRow()I

move-result p0

return p0
```

### .method public final getRowViews(I)Ljava/util/ArrayList;

После `.locals` добавить:

```smali
invoke-direct {p0, p1}, Lmiui/systemui/controlcenter/qs/tileview/BigTileGroupController;->customGetRowViews(I)Ljava/util/ArrayList;

move-result-object p0

return-object p0
```

### .method public final isBigTile(Lcom/android/systemui/plugins/qs/QSTile;)Z

`.locals 4` -> `.locals 6`

После `.locals` добавить:

```smali
move-object v4, p0

move-object v5, p1
```

Найти `return v0`, до него добавить:

```smali
invoke-direct {v4, v0, v5}, Lmiui/systemui/controlcenter/qs/tileview/BigTileGroupController;->customIsBigTile(ZLcom/android/systemui/plugins/qs/QSTile;)Z
    
move-result v0
```

### .method protected onCreate()V

Найти:

```smali
invoke-super {p0}, Lmiui/systemui/controlcenter/utils/ControlCenterViewController;->onCreate()V
```

После добавить:

```smali
invoke-direct {p0}, Lmiui/systemui/controlcenter/qs/tileview/BigTileGroupController;->customOnCreate()V
```

Найти:

```smali
iget-object v1, p0, Lmiui/systemui/controlcenter/qs/tileview/BigTileGroupController;->bigTileA:Lmiui/systemui/controlcenter/qs/tileview/BigTileView;

const/4 v2, 0x0

if-nez v1, :cond_0

const-string v1, "bigTileA"

invoke-static {v1}, Lb/f/b/l;->b(Ljava/lang/String;)V

move-object v1, v2

:cond_0
const-string v3, "wifi"
```

После добавить:

```smali
const-string v2, "my_custom_big_tile_a_tag"

invoke-direct {p0, v2, v3}, Lmiui/systemui/controlcenter/qs/tileview/BigTileGroupController;->getCustomBigTileTag(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;

move-result-object v3

const/4 v2, 0x0
```

Найти:

```smali
invoke-virtual {v2}, Lmiui/systemui/controlcenter/qs/QSController;->getHasMobileDataFeature()Z

move-result v2

if-eqz v2, :cond_2

const-string v2, "cell"

goto :goto_0

:cond_2
const-string v2, "bt"

:goto_0
```

После добавить:

```smali
const-string v3, "my_custom_big_tile_b_tag"

invoke-direct {p0, v3, v2}, Lmiui/systemui/controlcenter/qs/tileview/BigTileGroupController;->getCustomBigTileTag(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;

move-result-object v2
```

### .method protected onDestroy()V

После `.locals` добавить:

```smali
invoke-direct {p0}, Lmiui/systemui/controlcenter/qs/tileview/BigTileGroupController;->customOnDestroy()V
```

### .method public onStateChanged(Landroidx/lifecycle/LifecycleOwner;Landroidx/lifecycle/Lifecycle$Event;)V

`.locals 2` -> `.locals 3`

После `.locals` добавить:

```smali
move-object v2, p0
```

Найти:

```smali
:cond_4
return-void
```

До этого добавить:

```smali
invoke-direct {v2}, Lmiui/systemui/controlcenter/qs/tileview/BigTileGroupController;->customOnStateChanged()V
```

### .method public final setListening(Z)V

После `.locals` добавить:

```smali
invoke-direct {p0, p1}, Lmiui/systemui/controlcenter/qs/tileview/BigTileGroupController;->customSetListening(Z)V
```

